<% if @product.product_customization_types && !@product.product_customization_types.empty? %>

  <div id="product-customizations">

    <%# for finding optional partials %>
    <% lookup=ActionView::LookupContext.new(ActionController::Base.view_paths, {:formats => [:html]}) %>

    <h6 class="product-section-title"><%= t(:customizations) %></h6>
    <% @product.product_customization_types.each do |product_customization_type| %>

      <% param_prefix = "product_customizations[#{product_customization_type.id}]" %>

      <%# render a custom partial based on the customization name? %>

      <% partial_name = "spree/products/customizations/customization_type/#{product_customization_type.name}" %>
      <% if lookup.exists?(partial_name,nil,true) %>
        <%= render :partial => partial_name, :locals => {:product_customization_type => product_customization_type, :param_prefix => param_prefix} %>
      <% else %>

        <%# render a custom partial based on the calculator name? %>
        <% partial_name = "spree/products/customizations/calculator_type/#{calculator_name(product_customization_type)}" %>

        <% if lookup.exists?(partial_name,nil,true) %>
          <%= render :partial => partial_name, :locals => {:product_customization_type=>product_customization_type, :param_prefix => param_prefix} %>
        <% else %>

          <%= field_set_tag product_customization_type.presentation do %>

            <% product_customization_type.customizable_product_options.each do |option| %>
              <%= text_field_tag "#{param_prefix}[#{option.id}]","",:style=>"float: left;", :class=>"customization" %>
            <% end %> <%# options.each %>

          <% end %> <%# field_set_tag %>

        <% end %> <%# else %>
      <% end %> <%# else %>
    <% end %> <%# each customization type %>
  </div> <!-- product-customizations -->
<% end %>
